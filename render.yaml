# =============================================================================
# Render Blueprint - Home Credit Scoring
# =============================================================================
# Déploiement automatique des 3 services sur Render
# Documentation: https://render.com/docs/blueprint-spec
#
# ARCHITECTURE:
# - GitHub Actions: Tests unitaires + Build images Docker + Push GHCR
# - Render: Déploiement des services avec variables d'environnement
#
# Les variables d'environnement ci-dessous sont injectées par Render au runtime
# et écrasent les valeurs par défaut des Dockerfiles.
# =============================================================================

services:
  # =========================================
  # 1. API FastAPI - Scoring Credit (GHCR)
  # =========================================
  - type: web
    name: home-scoring-api
    runtime: image
    image:
      url: ghcr.io/absiinator/openclassrooms-ml-ops-api:latest
    plan: free
    region: frankfurt
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      - key: PORT
        value: "8000"
      - key: PYTHONPATH
        value: /app

  # =========================================
  # 2. Dashboard Streamlit (GHCR)
  # =========================================
  - type: web
    name: home-scoring-dashboard
    runtime: image
    image:
      url: ghcr.io/absiinator/openclassrooms-ml-ops-dashboard:latest
    plan: free
    region: frankfurt
    healthCheckPath: /_stcore/health
    autoDeploy: true
    envVars:
      - key: PORT
        value: "8501"
      # URLs des autres services Render (injectées au runtime)
      - key: API_URL
        value: "https://home-scoring-api.onrender.com"
      - key: MLFLOW_URL
        value: "https://home-scoring-mlflow.onrender.com"

  # =========================================
  # 3. MLflow UI - Tracking des expériences (GHCR)
  # =========================================
  - type: web
    name: home-scoring-mlflow
    runtime: image
    image:
      url: ghcr.io/absiinator/openclassrooms-ml-ops-mlflow:latest
    plan: free
    region: frankfurt
    healthCheckPath: /
    autoDeploy: true
    envVars:
      - key: PORT
        value: "5000"
